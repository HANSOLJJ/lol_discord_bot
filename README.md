# 🎮 League of Legends 챔피언 픽 Discord Bot

## 📋 프로젝트 개요

6명의 플레이어가 리그 오브 레전드 챔피언을 순서대로 선택하는 Discord 봇입니다.

### 🎯 주요 기능

1. **팀 구성**: 6명을 랜덤으로 3:3 팀으로 나눔
2. **챔피언 선택**:
   - 8개의 랜덤 챔피언 제시
   - 승수가 낮은 사람부터 순서대로 선택 (공평성)
   - 개인별 제한 시간 (설정 가능)
   - 시간 초과 시 자동 랜덤 배정
3. **전적 관리**:
   - 승/패 기록 자동 저장
   - 오늘의 전적 및 누적 전적 표시
   - 승률 자동 계산
4. **시각적 표시**:
   - 팀별 색상 구분 (🔵 team1 파란색, 🔴 team2 빨간색)
   - 실시간 타이머 표시 (큰 폰트)
   - 선택 현황 및 픽순 한눈에 확인

---

## 🔧 개발 이력 (2025-11-13)

### ✅ 완료된 작업

1. **시작 버튼 추가**
   - `/게임시작` 후 수동으로 챔피언 선택 시작
   - 준비 시간 확보 가능

2. **팀 배정 랜덤화**
   - 이전: 픽 순서대로 반으로 나눔 (승수 낮은팀 vs 높은팀)
   - 현재: 완전 랜덤 팀 배정

3. **UI 강조 개선**
   - 남은 시간 큰 폰트로 표시 (embed description 사용)
   - 현재 차례 플레이어 강조

4. **팀별 색상 구분**
   - Team1: 🔵 파란색 버튼 (primary)
   - Team2: 🔴 빨간색 버튼 (danger)
   - 선택 현황에도 팀 이모지 표시

5. **픽순 통합 표시**
   - 선택 현황에 승수 함께 표시
   - 별도 픽순 메시지 제거 (간결화)

6. **전적 시스템 개선**
   - `total_rounds` 추가 (누적 판수 추적)
   - 봇 재시작 시 라운드 번호 이어지기
   - 오늘의 전적과 누적 전적 분리 표시
   - 승률 자동 계산

7. **성능 최적화**
   - Discord API 호출 최적화 (embed + view 동시 업데이트)
   - 반응 속도 약 2배 개선

8. **코드 주석 추가**
   - 모든 주요 함수에 docstring 추가
   - 매개변수 및 반환값 설명

---

## 📁 프로젝트 구조

```
champ_pick/
├── got_champe.py          # 메인 봇 코드
├── config.json            # 게임 설정 (timeout, 챔피언 수)
├── wins.json              # 실제 전적 데이터
├── wins_dev.json          # 개발용 전적 데이터
├── .env                   # 환경변수 (토큰, DEV_MODE)
├── README.md              # 프로젝트 문서 (이 파일)
└── backup/                # 백업 파일들
```

---

## ⚙️ 설정 파일

### 1. `.env`
```env
DISCORD_TOKEN=your_discord_bot_token_here
DEV_MODE=true    # 개발 모드: true, 실제 모드: false
```

**DEV_MODE 차이점:**

| 항목 | DEV_MODE=true | DEV_MODE=false |
|------|---------------|----------------|
| 사용 파일 | `wins_dev.json` | `wins.json` |
| 유저 생성 | MockUser (가상) | 실제 Discord 유저 |
| 턴제 검증 | ❌ 없음 (누구나 선택 가능) | ✅ 있음 (자기 차례만) |
| 용도 | 테스트 및 개발 | 실제 Discord 서버 |

### 2. `config.json`
```json
{
  "pick_timeout": 15,      // 챔피언 선택 제한 시간 (초)
  "champion_count": 8      // 제시할 챔피언 수
}
```

### 3. `wins.json` / `wins_dev.json`
```json
{
  "total_rounds": 74,            // 총 게임 판수 (자동 증가)
  "365414320332472332": {        // Discord User ID (실제 모드)
    "name": "정한솔",
    "wins": 42
  },
  "100000000000000001": {        // 가짜 ID (개발 모드)
    "name": "jaecheol232",
    "wins": 31
  }
}
```

**⚠️ 중요:**
- **실제 모드(`wins.json`)**: 반드시 실제 Discord User ID 사용
- **개발 모드(`wins_dev.json`)**: 가짜 ID 사용 가능

---

## 🚀 실행 방법

### 1. 필요한 패키지 설치
```bash
pip install py-cord requests python-dotenv
```

### 2. 환경 설정
1. `.env` 파일에 Discord Bot Token 추가
2. `DEV_MODE` 설정 (개발: `true`, 실제: `false`)
3. 실제 모드 사용 시 `wins.json`에 실제 Discord User ID 입력

### 3. 봇 실행
```bash
python got_champe.py
```

### 4. Discord에서 사용
```
/게임시작          # 팀 배정 및 챔피언 제시
🚀 챔피언 선택 시작  # 버튼 클릭하여 게임 시작
(챔피언 버튼 클릭)  # 순서대로 챔피언 선택
/승리              # 승리 팀 선택 후 전적 업데이트
```

---

## 🎮 게임 흐름

1. **`/게임시작`** 명령 실행
   - 6명 선택 (DEV_MODE: wins_dev.json, 실제: 온라인 유저)
   - 랜덤 3:3 팀 배정
   - 픽 순서 계산 (승수 낮은 순)
   - 랜덤 챔피언 8개 제시

2. **"🚀 챔피언 선택 시작" 버튼 클릭**
   - 타이머 시작
   - 첫 번째 플레이어 차례

3. **챔피언 선택**
   - 자기 차례에 챔피언 버튼 클릭
   - 시간 초과 시 자동 랜덤 배정
   - 팀별 색상으로 표시 (🔵/🔴)

4. **모두 선택 완료**
   - "승리한 팀 선택" 드롭다운 표시

5. **`/승리` 또는 드롭다운 선택**
   - 승리 팀 선택
   - 전적 자동 업데이트
   - 오늘의 전적 및 누적 전적 표시

---

## 🔑 핵심 알고리즘

### 픽 순서 계산
```python
def calculate_pick_order(members):
    """
    승수 낮은 순서대로 정렬
    동률 시 랜덤 섞기
    """
    # 1. 승수별로 그룹화
    # 2. 각 그룹 내 랜덤 섞기
    # 3. 승수 낮은 순으로 합치기
```

### 턴제 검증 (실제 모드)
```python
if not DEV_MODE:
    if interaction.user.id != current_picker.id:
        # 자기 차례 아니면 경고
        return
```

### 타이머 중복 방지
```python
if picker_index != current_pick_index:
    # 다른 사람이 선택 완료하면 타이머 자동 종료
    return
```

---

## 🐛 알려진 이슈 및 해결

### ✅ 해결됨
1. **타이머 오버랩**: index 검증으로 해결
2. **메시지 스팸**: embed 통합 업데이트로 해결
3. **반응 느림**: API 호출 최적화로 해결
4. **팀 고정**: 랜덤 섞기로 해결

### ⚠️ 주의사항
1. **실제 모드 전 wins.json 확인**
   - 모든 유저의 실제 Discord ID 필요
   - ID 확인: Discord 개발자 모드 → 유저 우클릭 → "ID 복사"

2. **전적 백업**
   - 정기적으로 wins.json 백업 권장

---

## 📊 데이터 구조

### 전역 상태
```python
champion_list = []              # 전체 챔피언 리스트
selected_users = {}             # user_id: 선택한 챔피언
pick_order = []                 # 픽 순서 (member 객체)
current_pick_index = 0          # 현재 차례
current_teams = {}              # 팀 구성
overall_results = {}            # 세션 전적
wins_data = {}                  # 영구 전적
game_started = False            # 게임 시작 여부
```

---

## 🔮 향후 개선 가능 사항

1. **통계 명령어 추가**
   - `/전적` - 개인 전적 조회
   - `/랭킹` - 승률 순위

2. **챔피언 제외 기능**
   - 특정 챔피언 제외 리스트

3. **밴픽 모드**
   - 챔피언 밴 단계 추가

4. **데이터 시각화**
   - 그래프로 전적 표시

5. **다중 서버 지원**
   - 서버별 전적 분리

---

## 📝 라이센스

이 프로젝트는 개인 학습 및 사용 목적으로 제작되었습니다.

---

## 🤝 기여

버그 발견 시 Issues에 제보해주세요!

---

## 📞 문의

프로젝트 관련 문의사항은 Discord 서버에서 문의해주세요.
